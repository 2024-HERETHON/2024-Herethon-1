<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/ranking.css' %}" />
    <link rel="stylesheet" href="{% static 'js/ranking.js' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <title>랭킹</title>
</head>

<body>
    <header>
        <!-- 뒤로가기 버튼 -->
        <a href="{% url 'mainApp:main' %}">
            <svg class="back" width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M5 13C5 12.6598 5.15691 12.3387 5.42503 12.1303L16.2307 3.73069C16.7096 3.35841 17.3988 3.446 17.77 3.92633C18.1412 4.40666 18.0538 5.09784 17.5749 5.47012L7.88808 13L17.5749 20.5299C18.0538 20.9022 18.1412 21.5933 17.77 22.0737C17.3988 22.554 16.7096 22.6416 16.2307 22.2693L5.42503 13.8697C5.15691 13.6613 5 13.3402 5 13Z" fill="black" />
            </svg>
        </a>
  
        <h2>랭킹</h2>
  
        <!-- 알림 버튼 -->
        <a href="{% url 'mainApp:notice' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="26" viewBox="0 0 25 26" fill="none">
            <path d="M12.4605 19.2354H19.5542C19.8305 19.2509 20.1061 19.1954 20.3548 19.0741C20.6035 18.9529 20.8169 18.7699 20.9749 18.5427C21.1328 18.3156 21.2299 18.0517 21.2569 17.7764C21.2839 17.501 21.24 17.2233 21.1292 16.9698C20.7542 15.8365 19.2594 14.4771 19.2594 13.1396C19.2594 10.1708 19.2594 9.38959 17.7969 7.64375C17.3231 7.08238 16.7364 6.62702 16.0751 6.3073L15.2594 5.91146C15.1221 5.82941 15.0037 5.71924 14.912 5.58819C14.8202 5.45714 14.7572 5.30816 14.7271 5.15105C14.6456 4.6223 14.366 4.14436 13.9451 3.81416C13.5242 3.48395 12.9934 3.32621 12.4605 3.37292C11.9372 3.34149 11.4209 3.50627 11.0126 3.83507C10.6042 4.16386 10.3331 4.63307 10.2521 5.15105C10.2155 5.31335 10.1436 5.46561 10.0415 5.59703C9.93945 5.72844 9.80972 5.83579 9.66152 5.91146L8.8459 6.3073C8.18489 6.62714 7.59858 7.08249 7.12506 7.64375C5.66361 9.38959 5.66361 10.1708 5.66361 13.1396C5.66361 14.4771 4.23652 15.7 3.86152 16.901C3.63548 17.6271 3.51048 19.2354 5.40319 19.2354H12.4605Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M15.8594 19.2354C15.8686 19.6843 15.787 20.1304 15.6195 20.547C15.4519 20.9635 15.2019 21.3419 14.8844 21.6594C14.5669 21.9769 14.1886 22.2269 13.772 22.3944C13.3555 22.562 12.9093 22.6436 12.4605 22.6344C12.0115 22.6439 11.5653 22.5625 11.1487 22.395C10.7321 22.2276 10.3536 21.9775 10.0362 21.66C9.71874 21.3424 9.46882 20.9639 9.30149 20.5472C9.13416 20.1306 9.05288 19.6843 9.06254 19.2354" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        </a>
    </header>

    <div class="bottom">
        <!--   로그인이 되어 있지 않으면   -->
        {% if not user.is_authenticated %}
        {% else %}
        {% endif %} <br>

        <div class="todayC">
            <h2>오늘의 챌린지 왕은?</h2>
            <img class="crown" src="{% static 'img\왕관.png' %}" alt="왕관" />
            <dic class ="topRank">
            <div class="second">
            {% if monthly_posts %}
            {% for post in monthly_posts %}
                {% if forloop.counter == 2 %}
                <div class="post-container">
                    <div class="nickimg">
                    <h4> {{ post.author.nickname }} </h4>
                    {% if post.author.image %}
                        <div class="post-image">
                            <img src="{{ post.author.image.url }}">
                        </div>
                    </div>
                        <img class="secondGraph" src="{% static 'img\2등그래프.png' %}" alt="2등" />
                    {% endif %}
                    <div class="post-details">
                        <img class="like" src="{% static 'img\좋아요.png' %}" alt="좋아요" />
                        <p>{{ post.like.count }} </p>
                        <br>
                    </div>
                </div>
            </div>
            <div class="first">
                {% endif %}

            {% endfor %}
        {% for post in monthly_posts %}
                {% if forloop.counter == 1 %}
                <div class="post-container">
                    <div class="nickimg">
                    <h4> {{ post.author.nickname }} </h4>
                    {% if post.author.image %}
                        <div class="post-image">
                            <img src="{{ post.author.image.url }}">
                        </div>
                        </div>
                        <img class="firstGraph" src="{% static 'img\1등그래프.png' %}" alt="1등" />
                    {% endif %}
                    <div class="post-details">
                        <img class="like" src="{% static 'img\좋아요.png' %}" alt="좋아요" />
                        <p>{{ post.like.count }} </p>
                        <br>
                    </div>
                </div>
            </div>
            <div class="third">
                {% endif %}

            {% endfor %}
        {% for post in monthly_posts %}
                {% if forloop.counter == 3 %}
                <div class="post-container">
                    <div class="nickimg">
                    <h4> {{ post.author.nickname }} </h4>
                    {% if post.author.image %}
                        <div class="post-image">
                            <img src="{{ post.author.image.url }}">
                        </div>
                    </div>
                        <img class="thirdGraph" src="{% static 'img\3등그래프.png' %}" alt="3등" />
                    {% endif %}
                    <div class="post-details"> 
                        <img class="like" src="{% static 'img\좋아요.png' %}" alt="좋아요" />
                        <p>{{ post.like.count }} </p>
                        <br>
                    </div>
                </div>
            </div>
                {% endif %}

            {% endfor %}
        {% else %}
        {% endif %}
        </div>
    </dic>

        <div class="explain">
            <img
                  class="coupon"
                  src="{%static 'img\쿠폰.png' %}"
                  alt="쿠폰"
                />
                <div class="ex1">이번 달 챌린지 1등에게는</div>
                <div class="ex1">‘숲스토리’ 물물교환 쿠폰을 드려요!</div>
                <div class="ex2">‘숲스토리’는 발달장애인의 자립을 위해 설립된 리사이클 가게로, 기부된 중고 물품과 의류를 판매하는 곳입니다.</div>
                <div class="ex3">더 많은 챌린지 참여로 당첨 확률을 높여보세요!</div>
            </div>

        <div class="allRanks">
            <h3>전체 랭킹 확인하기</h3>
            {% if monthly_posts %}
                {% for post in monthly_posts %}
                <div class="post-container {% if forloop.counter == 1 %}rank-1{% elif forloop.counter == 2 %}rank-2{% elif forloop.counter == 3 %}rank-3{% endif %} {% if forloop.counter > 6 %}extra{% endif %}">
                        <p class="number">{{ forloop.counter }} </p>
                        {% if post.author.image %}
                            <div class="post-image">
                                <img src="{{ post.author.image.url }}">
                            </div>
                        {% endif %}
                        <div class="post-details">
                            <div class="post-details-details">
                            <h4> {{ post.author.nickname }} </h4>
                            <p><a href="{% url 'mainApp:detail' post.id %}">{{ post.title }}</a></p>
                        </div>
                        <div class="heart">
                            <img
                                class="allRankHeart"
                                src="{%static 'img\좋아요.png' %}"
                                alt="좋아요"
                              /> 
                              <p>{{ post.like.count }} </p>
                            </div> 
                        </div>
                    </div>
                {% endfor %}
            {% else %}
            {% endif %}
            <button id="show-more-btn" onclick="toggleRankings()">
                <img src="{% static 'img/버튼.png' %}" alt="Show More" />
            </button>
                       
        </div>

        <div class="container">
            <h3>내 랭킹은 몇 위?</h3>
            <div class="myRank {% if user_post_rank <= 3 %}rank-under-3{% endif %}">
                {% if user_post %}
                    <p class="number">{{ user_post_rank }}</p>
                    {% if user_post.image %}
                        <div class="post-image">
                            <img src="{{ user_post.image.url }}" alt="프로필사진">
                        </div>
                    {% endif %}
                    <div class="post-details">
                        <div class="post-details-details">
                            <h4>{{ user_post.author.nickname }}</h4>
                            <p><a href="{% url 'mainApp:detail' user_post.id %}">{{ user_post.title }}</a></p>
                        </div>
                    </div>
                    <div class="heart">
                        <img class="allRankHeart" src="{% static 'img/좋아요.png' %}" alt="좋아요" />
                        <p>{{ user_post.like.count }}</p>
                    </div>
                {% else %}
                <p class="no">작성된 글이 없습니다</p>
                {% endif %}
            </div>
        </div>

        <div class="mycontainer">
            <h3>내 챌린지 참여 현황 </h3>
            <div class="thismonth">
            <p>이번 달 참여</p>
            <div>{{ user_posts_monthly_count }}회</div>
        </div>
        <div class="total">
            <p>전체 누적 참여</p>
        <div>{{ user_posts_count }}회</div>
        </div>
        <p class="last">다양한 주제의 중복 참여를 통해 랭킹 순위를 높여보세요!</p>
        </div>
    </div>

    <footer class="community_footer">
        <div class="community_footer_home">
          <a href="{% url 'mainApp:main' %}">
            <img src="../../../media/Home.png" alt="홈" width="20px" height="20px">
          </a>
          <p>홈</p>
        </div>
        <div class="community_footer_rank">
          <a href="{% url 'mainApp:ranking' %}">
            <img src="../../../media/Rank.png" alt="랭킹" width="20px" height="20px">
          </a>
          <p>랭킹</p>
        </div>
        <div class="community_footer_community">
          <a href="{% url 'mainApp:tipList' %}">
            <img src="../../../media/Community.png" alt="커뮤니티" width="20px" height="20px">
          </a>
          <p>커뮤니티</p>
        </div>
        <div class="community_footer_my">
          {% if not user.is_authenticated %}
          <img src="../../../media/My.png" alt="마이" width="20px" height="20px">
          {% else %}
          <a href="{% url 'accountApp:detail' pk=user.pk %}">
            <img src="../../../media/My.png" alt="마이" width="20px" height="20px">
          </a>
          {% endif %}
          <p>MY</p>
        </div>
      </footer>

    <script>
        function toggleRankings() {
            const extraRankings = document.querySelectorAll('.post-container.extra');
            const showMoreBtn = document.getElementById('show-more-btn');
    
            extraRankings.forEach(item => {
                if (item.style.display === 'none' || item.style.display === '') {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none'; // 변경: 닫히는 기능 추가
                }
            });
    
            // Toggle button text between 'Show More' and 'Show Less'
            if (showMoreBtn.getAttribute('data-state') === 'hidden') {
                showMoreBtn.querySelector('img').src = '{% static "img/버튼.png" %}';
                showMoreBtn.setAttribute('data-state', 'visible');
            } else {
                showMoreBtn.querySelector('img').src = '{% static "img/버튼.png" %}';
                showMoreBtn.setAttribute('data-state', 'hidden');
            }
        }
    
        // Initially hide the extra rankings
        document.addEventListener('DOMContentLoaded', () => {
            const extraRankings = document.querySelectorAll('.post-container.extra');
            extraRankings.forEach(item => item.style.display = 'none');
        });
    </script>
    
    
    
    
</body>
</html>